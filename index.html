<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROBUSTEM√âTA</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<!-- Markdown -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
body {
  margin:0;
  font-family:system-ui;
  background:#0b0b0b;
  color:#fff;
}
header {
  background:#000;
  padding:12px;
  text-align:center;
  font-weight:bold;
}
button {
  background:#1e90ff;
  border:none;
  color:#fff;
  padding:10px;
  margin:5px;
  border-radius:6px;
}
textarea, input {
  width:95%;
  margin:5px;
  padding:10px;
  border-radius:6px;
  border:none;
}
.post {
  background:#151515;
  padding:10px;
  margin:10px;
  border-radius:8px;
}
.admin { border:2px solid gold; }
</style>
</head>

<body>

<header>ROBUSTEM√âTA ‚Äî ULTIME</header>

<div id="auth">
  <button onclick="login()">Connexion Google</button>
</div>

<div id="app" style="display:none">

<h3>Bienvenue <span id="user"></span></h3>

<!-- ADMIN CMS -->
<div id="admin" style="display:none">
  <h4>Admin ‚Äî Nouveau post (Markdown)</h4>
  <input id="title" placeholder="Titre">
  <textarea id="content" rows="6" placeholder="Contenu Markdown"></textarea>
  <button onclick="publish()">Publier</button>
</div>

<hr>

<!-- FEED -->
<div id="feed"></div>

</div>

<script>
// üî• CONFIG FIREBASE (REMPLACE)
firebase.initializeApp({
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID"
});

const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

// AUTH
function login(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    document.getElementById("auth").style.display="none";
    document.getElementById("app").style.display="block";
    document.getElementById("user").innerText = user.displayName;

    // ADMIN EMAIL
    if(user.email === "TON_EMAIL@gmail.com"){
      document.getElementById("admin").style.display="block";
    }

    loadPosts();
  }
});

// PUBLISH
function publish(){
  const title = titleInput.value;
  const content = contentInput.value;
  db.collection("posts").add({
    title, content,
    author: currentUser.displayName,
    uid: currentUser.uid,
    time: Date.now()
  });
}

// LOAD POSTS
function loadPosts(){
  db.collection("posts").orderBy("time","desc")
  .onSnapshot(snap=>{
    feed.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      const div = document.createElement("div");
      div.className="post";
      div.innerHTML = `
        <h4>${d.title}</h4>
        <div>${marked.parse(d.content)}</div>
        <small>${d.author}</small><br>
        <button onclick="like('${doc.id}')">‚ù§Ô∏è</button>
      `;
      feed.appendChild(div);
    });
  });
}

function like(id){
  alert("Like enregistr√© (extension possible)");
}
</script>

</body>
</html>